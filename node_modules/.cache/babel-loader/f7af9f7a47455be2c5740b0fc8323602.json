{"ast":null,"code":"import _slicedToArray from \"/home/skyparci/work/project/your-kname/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/home/skyparci/work/project/your-kname/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useReducer, useMemo, useCallback } from 'react';\nimport useDeepCompareEffect from 'use-deep-compare-effect';\nimport validate from './validate'; // constants\n\nconst UPDATE = 'UPDATE';\nconst VALIDATE = 'VALIDATE';\nconst BLUR = 'BLUR';\nconst SUBMIT = 'SUBMIT';\n\nfunction reducer(state, {\n  type,\n  payload\n}) {\n  switch (type) {\n    case UPDATE:\n      const values = _objectSpread({}, state.values, {}, payload);\n\n      return _objectSpread({}, state, {\n        values,\n        errors: {}\n      });\n\n    case VALIDATE:\n      return _objectSpread({}, state, {\n        errors: payload\n      });\n\n    case BLUR:\n      const blurred = _objectSpread({}, state.blurred, {\n        [payload]: true\n      });\n\n      return _objectSpread({}, state, {\n        blurred\n      });\n\n    case SUBMIT:\n      return _objectSpread({}, state, {\n        isSubmitted: true\n      });\n\n    default:\n      return state;\n  }\n}\n\nconst useForm = (config = {}, submitCallback) => {\n  const _useReducer = useReducer(reducer, getInitialState(config)),\n        _useReducer2 = _slicedToArray(_useReducer, 2),\n        state = _useReducer2[0],\n        dispatch = _useReducer2[1];\n\n  if (typeof config === 'function') config = config(state.values);\n  if (!config.fields) throw Error('invalid config');\n  const errors = useMemo(() => getErrors(state, config), [state, config]);\n  const handleSubmit = useCallback(onSubmit, [state.values, errors]);\n  const isFormValid = useMemo(() => Object.values(errors).every(error => error === null), [errors]);\n  useDeepCompareEffect(() => {\n    const errors = validate(state.values, config.fields);\n    dispatch({\n      type: VALIDATE,\n      payload: errors\n    });\n  }, [state.values, config.fields]);\n\n  function getErrors(state, config) {\n    if (config.showErrors === 'always') {\n      return state.errors;\n    }\n\n    if (config.showErrors === 'blur') {\n      return Object.entries(state.blurred).filter(([, blurred]) => blurred).reduce((acc, [name]) => _objectSpread({}, acc, {\n        [name]: state.errors[name]\n      }), {});\n    }\n\n    return state.isSubmitted ? state.errors : {};\n  }\n\n  function getInitialState(config) {\n    if (typeof config === 'function') {\n      config = config({});\n    }\n\n    if (!config.fields) throw Error('invalid config');\n    const initial = Object.keys(config.fields).reduce(([initialValues, initialBlurred], fieldName) => {\n      initialValues[fieldName] = config.fields[fieldName].initialValue || '';\n      initialBlurred[fieldName] = false;\n      return [initialValues, initialBlurred];\n    }, [{}, {}]);\n    const initialErrors = validate(initial[0], config.fields);\n    return {\n      values: initial[0],\n      errors: initialErrors,\n      blurred: initial[1],\n      isSubmitted: false\n    };\n  }\n\n  function onSubmit(event) {\n    if (event) event.preventDefault();\n    submitCallback && submitCallback({\n      values: state.values,\n      isFormValid\n    });\n    dispatch({\n      type: SUBMIT\n    });\n  }\n\n  function resolveInputTypeValue(e) {\n    if (!e.target) return e; // custom input: Dropdown\n\n    if (e.target.type === 'checkbox') return e.target.checked;\n    return e.target.value;\n  }\n\n  function getFieldProps(fieldName, overrides = {}) {\n    return {\n      onChange: e => {\n        if (!config.fields[fieldName]) return;\n        const value = resolveInputTypeValue(e);\n        dispatch({\n          type: UPDATE,\n          payload: {\n            [fieldName]: value\n          }\n        });\n        if (overrides.onChange) overrides.onChange(e);\n      },\n      onBlur: () => {\n        dispatch({\n          type: BLUR,\n          payload: fieldName\n        });\n      },\n      name: fieldName,\n      value: state.values[fieldName] || '',\n      error: errors[fieldName],\n      'aria-invalid': String(!!errors[fieldName])\n    };\n  }\n\n  return {\n    isSubmitted: state.isSubmitted,\n    isFormValid,\n    handleSubmit,\n    getFieldProps,\n    errors\n  };\n};\n\nexport default useForm;","map":{"version":3,"sources":["/home/skyparci/work/project/your-kname/src/hooks/useValidation/useValidation.js"],"names":["useReducer","useMemo","useCallback","useDeepCompareEffect","validate","UPDATE","VALIDATE","BLUR","SUBMIT","reducer","state","type","payload","values","errors","blurred","isSubmitted","useForm","config","submitCallback","getInitialState","dispatch","fields","Error","getErrors","handleSubmit","onSubmit","isFormValid","Object","every","error","showErrors","entries","filter","reduce","acc","name","initial","keys","initialValues","initialBlurred","fieldName","initialValue","initialErrors","event","preventDefault","resolveInputTypeValue","e","target","checked","value","getFieldProps","overrides","onChange","onBlur","String"],"mappings":";;;;;;;AAAA,SAASA,UAAT,EAAqBC,OAArB,EAA8BC,WAA9B,QAAiD,OAAjD;AACA,OAAOC,oBAAP,MAAiC,yBAAjC;AACA,OAAOC,QAAP,MAAqB,YAArB,C,CACA;;AACA,MAAMC,MAAM,GAAG,QAAf;AACA,MAAMC,QAAQ,GAAG,UAAjB;AACA,MAAMC,IAAI,GAAG,MAAb;AACA,MAAMC,MAAM,GAAG,QAAf;;AAEA,SAASC,OAAT,CAAiBC,KAAjB,EAAwB;AAAEC,EAAAA,IAAF;AAAQC,EAAAA;AAAR,CAAxB,EAA2C;AACvC,UAAQD,IAAR;AACI,SAAKN,MAAL;AACI,YAAMQ,MAAM,qBAAQH,KAAK,CAACG,MAAd,MAAyBD,OAAzB,CAAZ;;AAEA,+BACOF,KADP;AAEIG,QAAAA,MAFJ;AAGIC,QAAAA,MAAM,EAAE;AAHZ;;AAKJ,SAAKR,QAAL;AACI,+BAAYI,KAAZ;AAAmBI,QAAAA,MAAM,EAAEF;AAA3B;;AACJ,SAAKL,IAAL;AACI,YAAMQ,OAAO,qBAAQL,KAAK,CAACK,OAAd;AAAuB,SAACH,OAAD,GAAW;AAAlC,QAAb;;AACA,+BAAYF,KAAZ;AAAmBK,QAAAA;AAAnB;;AACJ,SAAKP,MAAL;AACI,+BAAYE,KAAZ;AAAmBM,QAAAA,WAAW,EAAE;AAAhC;;AACJ;AACI,aAAON,KAAP;AAjBR;AAmBH;;AAED,MAAMO,OAAO,GAAG,CAACC,MAAM,GAAG,EAAV,EAAcC,cAAd,KAAiC;AAAA,sBACnBnB,UAAU,CAACS,OAAD,EAAUW,eAAe,CAACF,MAAD,CAAzB,CADS;AAAA;AAAA,QACtCR,KADsC;AAAA,QAC/BW,QAD+B;;AAE7C,MAAI,OAAOH,MAAP,KAAkB,UAAtB,EAAkCA,MAAM,GAAGA,MAAM,CAACR,KAAK,CAACG,MAAP,CAAf;AAClC,MAAI,CAACK,MAAM,CAACI,MAAZ,EAAoB,MAAMC,KAAK,CAAC,gBAAD,CAAX;AAEpB,QAAMT,MAAM,GAAGb,OAAO,CAAC,MAAMuB,SAAS,CAACd,KAAD,EAAQQ,MAAR,CAAhB,EAAiC,CAACR,KAAD,EAAQQ,MAAR,CAAjC,CAAtB;AACA,QAAMO,YAAY,GAAGvB,WAAW,CAACwB,QAAD,EAAW,CAAChB,KAAK,CAACG,MAAP,EAAeC,MAAf,CAAX,CAAhC;AACA,QAAMa,WAAW,GAAG1B,OAAO,CACvB,MAAM2B,MAAM,CAACf,MAAP,CAAcC,MAAd,EAAsBe,KAAtB,CAA4BC,KAAK,IAAIA,KAAK,KAAK,IAA/C,CADiB,EAEvB,CAAChB,MAAD,CAFuB,CAA3B;AAKAX,EAAAA,oBAAoB,CAAC,MAAM;AACvB,UAAMW,MAAM,GAAGV,QAAQ,CAACM,KAAK,CAACG,MAAP,EAAeK,MAAM,CAACI,MAAtB,CAAvB;AAEAD,IAAAA,QAAQ,CAAC;AAAEV,MAAAA,IAAI,EAAEL,QAAR;AAAkBM,MAAAA,OAAO,EAAEE;AAA3B,KAAD,CAAR;AACH,GAJmB,EAIjB,CAACJ,KAAK,CAACG,MAAP,EAAeK,MAAM,CAACI,MAAtB,CAJiB,CAApB;;AAMA,WAASE,SAAT,CAAmBd,KAAnB,EAA0BQ,MAA1B,EAAkC;AAC9B,QAAIA,MAAM,CAACa,UAAP,KAAsB,QAA1B,EAAoC;AAChC,aAAOrB,KAAK,CAACI,MAAb;AACH;;AAED,QAAII,MAAM,CAACa,UAAP,KAAsB,MAA1B,EAAkC;AAC9B,aAAOH,MAAM,CAACI,OAAP,CAAetB,KAAK,CAACK,OAArB,EACFkB,MADE,CACK,CAAC,GAAGlB,OAAH,CAAD,KAAiBA,OADtB,EAEFmB,MAFE,CAGC,CAACC,GAAD,EAAM,CAACC,IAAD,CAAN,uBAAuBD,GAAvB;AAA4B,SAACC,IAAD,GAAQ1B,KAAK,CAACI,MAAN,CAAasB,IAAb;AAApC,QAHD,EAIC,EAJD,CAAP;AAMH;;AACD,WAAO1B,KAAK,CAACM,WAAN,GAAoBN,KAAK,CAACI,MAA1B,GAAmC,EAA1C;AACH;;AAED,WAASM,eAAT,CAAyBF,MAAzB,EAAiC;AAC7B,QAAI,OAAOA,MAAP,KAAkB,UAAtB,EAAkC;AAC9BA,MAAAA,MAAM,GAAGA,MAAM,CAAC,EAAD,CAAf;AACH;;AAED,QAAI,CAACA,MAAM,CAACI,MAAZ,EAAoB,MAAMC,KAAK,CAAC,gBAAD,CAAX;AAEpB,UAAMc,OAAO,GAAGT,MAAM,CAACU,IAAP,CAAYpB,MAAM,CAACI,MAAnB,EAA2BY,MAA3B,CACZ,CAAC,CAACK,aAAD,EAAgBC,cAAhB,CAAD,EAAkCC,SAAlC,KAAgD;AAC5CF,MAAAA,aAAa,CAACE,SAAD,CAAb,GACIvB,MAAM,CAACI,MAAP,CAAcmB,SAAd,EAAyBC,YAAzB,IAAyC,EAD7C;AAEAF,MAAAA,cAAc,CAACC,SAAD,CAAd,GAA4B,KAA5B;AACA,aAAO,CAACF,aAAD,EAAgBC,cAAhB,CAAP;AACH,KANW,EAOZ,CAAC,EAAD,EAAK,EAAL,CAPY,CAAhB;AAUA,UAAMG,aAAa,GAAGvC,QAAQ,CAACiC,OAAO,CAAC,CAAD,CAAR,EAAanB,MAAM,CAACI,MAApB,CAA9B;AACA,WAAO;AACHT,MAAAA,MAAM,EAAEwB,OAAO,CAAC,CAAD,CADZ;AAEHvB,MAAAA,MAAM,EAAE6B,aAFL;AAGH5B,MAAAA,OAAO,EAAEsB,OAAO,CAAC,CAAD,CAHb;AAIHrB,MAAAA,WAAW,EAAE;AAJV,KAAP;AAMH;;AAED,WAASU,QAAT,CAAkBkB,KAAlB,EAAyB;AACrB,QAAIA,KAAJ,EAAWA,KAAK,CAACC,cAAN;AACX1B,IAAAA,cAAc,IAAIA,cAAc,CAAC;AAAEN,MAAAA,MAAM,EAAEH,KAAK,CAACG,MAAhB;AAAwBc,MAAAA;AAAxB,KAAD,CAAhC;AACAN,IAAAA,QAAQ,CAAC;AAAEV,MAAAA,IAAI,EAAEH;AAAR,KAAD,CAAR;AACH;;AAED,WAASsC,qBAAT,CAA+BC,CAA/B,EAAkC;AAC9B,QAAI,CAACA,CAAC,CAACC,MAAP,EAAe,OAAOD,CAAP,CADe,CACL;;AACzB,QAAIA,CAAC,CAACC,MAAF,CAASrC,IAAT,KAAkB,UAAtB,EAAkC,OAAOoC,CAAC,CAACC,MAAF,CAASC,OAAhB;AAClC,WAAOF,CAAC,CAACC,MAAF,CAASE,KAAhB;AACH;;AAED,WAASC,aAAT,CAAuBV,SAAvB,EAAkCW,SAAS,GAAG,EAA9C,EAAkD;AAC9C,WAAO;AACHC,MAAAA,QAAQ,EAAEN,CAAC,IAAI;AACX,YAAI,CAAC7B,MAAM,CAACI,MAAP,CAAcmB,SAAd,CAAL,EAA+B;AAC/B,cAAMS,KAAK,GAAGJ,qBAAqB,CAACC,CAAD,CAAnC;AAEA1B,QAAAA,QAAQ,CAAC;AACLV,UAAAA,IAAI,EAAEN,MADD;AAELO,UAAAA,OAAO,EAAE;AACL,aAAC6B,SAAD,GAAaS;AADR;AAFJ,SAAD,CAAR;AAOA,YAAIE,SAAS,CAACC,QAAd,EAAwBD,SAAS,CAACC,QAAV,CAAmBN,CAAnB;AAC3B,OAbE;AAcHO,MAAAA,MAAM,EAAE,MAAM;AACVjC,QAAAA,QAAQ,CAAC;AAAEV,UAAAA,IAAI,EAAEJ,IAAR;AAAcK,UAAAA,OAAO,EAAE6B;AAAvB,SAAD,CAAR;AACH,OAhBE;AAiBHL,MAAAA,IAAI,EAAEK,SAjBH;AAkBHS,MAAAA,KAAK,EAAExC,KAAK,CAACG,MAAN,CAAa4B,SAAb,KAA2B,EAlB/B;AAmBHX,MAAAA,KAAK,EAAEhB,MAAM,CAAC2B,SAAD,CAnBV;AAoBH,sBAAgBc,MAAM,CAAC,CAAC,CAACzC,MAAM,CAAC2B,SAAD,CAAT;AApBnB,KAAP;AAsBH;;AAED,SAAO;AACHzB,IAAAA,WAAW,EAAEN,KAAK,CAACM,WADhB;AAEHW,IAAAA,WAFG;AAGHF,IAAAA,YAHG;AAIH0B,IAAAA,aAJG;AAKHrC,IAAAA;AALG,GAAP;AAOH,CAxGD;;AA0GA,eAAeG,OAAf","sourcesContent":["import { useReducer, useMemo, useCallback } from 'react';\nimport useDeepCompareEffect from 'use-deep-compare-effect';\nimport validate from './validate';\n// constants\nconst UPDATE = 'UPDATE';\nconst VALIDATE = 'VALIDATE';\nconst BLUR = 'BLUR';\nconst SUBMIT = 'SUBMIT';\n\nfunction reducer(state, { type, payload }) {\n    switch (type) {\n        case UPDATE:\n            const values = { ...state.values, ...payload };\n\n            return {\n                ...state,\n                values,\n                errors: {},\n            };\n        case VALIDATE:\n            return { ...state, errors: payload };\n        case BLUR:\n            const blurred = { ...state.blurred, [payload]: true };\n            return { ...state, blurred };\n        case SUBMIT:\n            return { ...state, isSubmitted: true };\n        default:\n            return state;\n    }\n}\n\nconst useForm = (config = {}, submitCallback) => {\n    const [state, dispatch] = useReducer(reducer, getInitialState(config));\n    if (typeof config === 'function') config = config(state.values);\n    if (!config.fields) throw Error('invalid config');\n\n    const errors = useMemo(() => getErrors(state, config), [state, config]);\n    const handleSubmit = useCallback(onSubmit, [state.values, errors]);\n    const isFormValid = useMemo(\n        () => Object.values(errors).every(error => error === null),\n        [errors],\n    );\n\n    useDeepCompareEffect(() => {\n        const errors = validate(state.values, config.fields);\n\n        dispatch({ type: VALIDATE, payload: errors });\n    }, [state.values, config.fields]);\n\n    function getErrors(state, config) {\n        if (config.showErrors === 'always') {\n            return state.errors;\n        }\n\n        if (config.showErrors === 'blur') {\n            return Object.entries(state.blurred)\n                .filter(([, blurred]) => blurred)\n                .reduce(\n                    (acc, [name]) => ({ ...acc, [name]: state.errors[name] }),\n                    {},\n                );\n        }\n        return state.isSubmitted ? state.errors : {};\n    }\n\n    function getInitialState(config) {\n        if (typeof config === 'function') {\n            config = config({});\n        }\n\n        if (!config.fields) throw Error('invalid config');\n\n        const initial = Object.keys(config.fields).reduce(\n            ([initialValues, initialBlurred], fieldName) => {\n                initialValues[fieldName] =\n                    config.fields[fieldName].initialValue || '';\n                initialBlurred[fieldName] = false;\n                return [initialValues, initialBlurred];\n            },\n            [{}, {}],\n        );\n\n        const initialErrors = validate(initial[0], config.fields);\n        return {\n            values: initial[0],\n            errors: initialErrors,\n            blurred: initial[1],\n            isSubmitted: false,\n        };\n    }\n\n    function onSubmit(event) {\n        if (event) event.preventDefault();\n        submitCallback && submitCallback({ values: state.values, isFormValid });\n        dispatch({ type: SUBMIT });\n    }\n\n    function resolveInputTypeValue(e) {\n        if (!e.target) return e; // custom input: Dropdown\n        if (e.target.type === 'checkbox') return e.target.checked;\n        return e.target.value;\n    }\n\n    function getFieldProps(fieldName, overrides = {}) {\n        return {\n            onChange: e => {\n                if (!config.fields[fieldName]) return;\n                const value = resolveInputTypeValue(e);\n  \n                dispatch({\n                    type: UPDATE,\n                    payload: {\n                        [fieldName]: value,\n                    },\n                });\n\n                if (overrides.onChange) overrides.onChange(e);\n            },\n            onBlur: () => {\n                dispatch({ type: BLUR, payload: fieldName });\n            },\n            name: fieldName,\n            value: state.values[fieldName] || '',\n            error: errors[fieldName],\n            'aria-invalid': String(!!errors[fieldName]),\n        };\n    }\n\n    return {\n        isSubmitted: state.isSubmitted,\n        isFormValid,\n        handleSubmit,\n        getFieldProps,\n        errors,\n    };\n};\n\nexport default useForm;\n"]},"metadata":{},"sourceType":"module"}